#!/bin/bash

set -o pipefail
set -o errexit
set -o nounset
set -o noglob

CMD=("rsync"
     "-hhh"
     "--verbose"
     "--info=progress2"
     "--archive"
     "--executability"
     "--delete"
     "--delete-excluded"
     "--exclude=*/cargo-target"
     "--exclude=*/rustup"
     "--exclude=*/target"
     "--exclude=*/__pycache__"
     '--exclude=emacs/elpa/*'
     '--exclude=node_modules/*'
     '--exclude=clangd/*'
     "$@")

echo ">>> Rsync command:" "${CMD[@]}"

cmd () {
  printf ">>> %s --> %s\n" "$1" "$2"
  "${CMD[@]}" "$1" "$2"
  printf "\n\n"
}

HNAME=$(hostnamectl hostname)
printf ">>> Hostname = %s\n\n\n" "$HNAME"

if [ "$HNAME" == "axon" ]; then
  HOME=/home/fred
  INT=/run/media/fred/Internal
  EXT=/run/media/fred/External

  if [ -d "$INT" ]; then
    cmd "$HOME/Archive/"                  "$INT/Fred/Archive/"
    cmd "$HOME/Documents/"                "$INT/Fred/Documents/"
    cmd "$HOME/Downloads/"                "$INT/Fred/Downloads/"
    cmd "$HOME/Music/"                    "$INT/Fred/Music/"
    cmd "$HOME/Music.New/"                "$INT/Fred/Music.New/"
    cmd "$HOME/Phone/"                    "$INT/Fred/Phone/"
    cmd "$HOME/Workspace/"                "$INT/Fred/Workspace/"

    cmd "$HOME/.ssh/"                     "$INT/Desktop/Configs/ssh/"
    cmd "$HOME/.config/beets/"            "$INT/Desktop/Configs/config-beets/"
    cmd "$HOME/.config/MusicBrainz/"      "$INT/Desktop/Configs/config-MusicBrainz/"
    cmd "$HOME/.config/transmission/"     "$INT/Desktop/Configs/config-transmission/"
    cmd "$HOME/.config/yt-dlp/"           "$INT/Desktop/Configs/config-yt-dlp/"
    cmd "$HOME/.config/weechat/"          "$INT/Desktop/Configs/config-weechat/"
    cmd "$HOME/.local/share/gnupg/"       "$INT/Desktop/Configs/local-share-gnupg/"
    cmd "$HOME/.local/share/keyrings/"    "$INT/Desktop/Configs/local-share-keyrings/"

    if [ -d "$EXT" ]; then
      cmd "$INT/Desktop/"   "$EXT/Desktop/"
      cmd "$INT/Fred/"      "$EXT/Fred/"
      cmd "$INT/FredOther/" "$EXT/FredOther/"
    else
      printf ">>> %s is not mounted\n" "$EXT"
      exit 0
    fi
  else
    printf ">>> %s is not mounted\n" "$INT"
  fi
elif [ "$HNAME" == "neuron" ]; then
  HOME=/home/fred
  LAPTOP=/run/media/fred/External/Laptop

  if [ -d "$LAPTOP" ]; then
    cmd "$HOME/Documents/"                "$LAPTOP/Documents/"
    cmd "$HOME/Downloads/"                "$LAPTOP/Downloads/"
    cmd "$HOME/Phone/"                    "$LAPTOP/Phone/"
    cmd "$HOME/Workspace/"                "$LAPTOP/Workspace/"
    cmd "$HOME/.ssh/"                     "$LAPTOP/Configs/ssh/"
    cmd "$HOME/.config/transmission/"     "$LAPTOP/Configs/config-transmission/"
    cmd "$HOME/.config/yt-dlp/"           "$LAPTOP/Configs/config-yt-dlp/"
    cmd "$HOME/.config/weechat/"          "$LAPTOP/Configs/config-weechat/"
    cmd "$HOME/.local/share/gnupg/"       "$LAPTOP/Configs/local-share-gnupg/"
    cmd "$HOME/.local/share/keyrings/"    "$LAPTOP/Configs/local-share-keyrings/"
  else
    printf ">>> %s is not mounted\n" "$LAPTOP"
  fi

  OX_EXT=/run/media/fred/OX-External/Laptop

  if [ -d "$OX_EXT" ]; then
    cmd "$HOME/Archive/"                  "$OX_EXT/Archive/"
    cmd "$HOME/Documents/"                "$OX_EXT/Documents/"
    cmd "$HOME/Downloads/"                "$OX_EXT/Downloads/"
    cmd "$HOME/Music/"                    "$OX_EXT/Music/"
    cmd "$HOME/Music.New/"                "$OX_EXT/Music.New/"
    cmd "$HOME/Phone/"                    "$OX_EXT/Phone/"
    cmd "$HOME/Workspace/"                "$OX_EXT/Workspace/"
    cmd "$HOME/.cache/"                   "$OX_EXT/.cache/"
    cmd "$HOME/.config/"                  "$OX_EXT/.config/"
    cmd "$HOME/.designer/"                "$OX_EXT/.designer/"
    cmd "$HOME/.local/"                   "$OX_EXT/.local/"
    cmd "$HOME/.mozilla/"                 "$OX_EXT/.mozilla/"
    cmd "$HOME/.ssh/"                     "$OX_EXT/.ssh/"
    cmd "$HOME/.var/"                     "$OX_EXT/.var/"
    cmd "$HOME/.zoom/"                    "$OX_EXT/.zoom/"
    cmd "$HOME/.ssh/"                     "$OX_EXT/.ssh/"
  else
    printf ">>> %s is not mounted\n" "$OX_EXT"
  fi
else
  printf ">>> Unknown machine with hostname = %s\n" "$HNAME"
fi
