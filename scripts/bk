#!/bin/bash

set -o pipefail
set -o errexit
set -o nounset
set -o noglob

CMD=("rsync"
     "-hhh"
     "--verbose"
     "--info=progress2"
     "--archive"
     "--executability"
     "--delete"
     "--delete-excluded"
     "--exclude=*/target"
     "--exclude=*/__pycache__"
     '--exclude=emacs/elpa/*'
     '--exclude=node_modules/*'
     "$@")

echo ">>> Rsync command:" "${CMD[@]}"

cmd () {
    printf ">>> %s --> %s\n" "$1" "$2"
    "${CMD[@]}" "$1" "$2"
    printf "\n\n"
}

HNAME=$(hostnamectl hostname)
printf ">>> Hostname = %s\n\n\n" "$HNAME"

if [ "$HNAME" == "axon" ]; then
    HOME=/home/fred
    INT=/run/media/fred/Internal
    EXT=/run/media/fred/External

    if [ -d $INT ]; then
        cmd "$HOME/Archive/"                  "$INT/Fred/Archive/"
        cmd "$HOME/Documents/"                "$INT/Fred/Documents/"
        cmd "$HOME/Downloads/"                "$INT/Fred/Downloads/"
        cmd "$HOME/Music/"                    "$INT/Fred/Music/"
        cmd "$HOME/Music.New/"                "$INT/Fred/Music.New/"
        cmd "$HOME/Phone/"                    "$INT/Fred/Phone/"
        cmd "$HOME/Workspace/"                "$INT/Fred/Workspace/"

        cmd "$HOME/.ssh/"                     "$INT/Desktop/Configs/ssh/"
        cmd "$HOME/.config/beets/"            "$INT/Desktop/Configs/config-beets/"
        cmd "$HOME/.config/MusicBrainz/"      "$INT/Desktop/Configs/config-MusicBrainz/"
        cmd "$HOME/.config/transmission/"     "$INT/Desktop/Configs/config-transmission/"
        cmd "$HOME/.config/yt-dlp/"           "$INT/Desktop/Configs/config-yt-dlp/"
        cmd "$HOME/.config/weechat/"          "$INT/Desktop/Configs/config-weechat/"
        cmd "$HOME/.local/share/gnupg/"       "$INT/Desktop/Configs/local-share-gnupg/"
        cmd "$HOME/.local/share/hamster/"     "$INT/Desktop/Configs/local-share-hamster/"
        cmd "$HOME/.local/share/keyrings/"    "$INT/Desktop/Configs/local-share-keyrings/"

        if [ -d $EXT ]; then
            cmd "$INT/Desktop/"   "$EXT/Desktop/"
            cmd "$INT/Fred/"      "$EXT/Fred/"
            cmd "$INT/FredOther/" "$EXT/FredOther/"
        else
            printf ">>> %s is not mounted\n" "$EXT"
            exit 0
        fi
    else
        printf ">>> %s is not mounted\n" "$INT"
        exit 1
    fi
elif [ "$HNAME" == "neuron" ]; then
    HOME=/home/fred
    LAPTOP=/run/media/fred/External/Laptop

    if [ -d $LAPTOP ]; then
        cmd "$HOME/Documents/"                "$LAPTOP/Documents/"
        cmd "$HOME/Downloads/"                "$LAPTOP/Downloads/"
        cmd "$HOME/Phone/"                    "$LAPTOP/Phone/"
        cmd "$HOME/Workspace/"                "$LAPTOP/Workspace/"
        cmd "$HOME/.ssh/"                     "$LAPTOP/Configs/ssh/"
        cmd "$HOME/.config/transmission/"     "$LAPTOP/Configs/config-transmission/"
        cmd "$HOME/.config/yt-dlp/"           "$LAPTOP/Configs/config-yt-dlp/"
        cmd "$HOME/.config/weechat/"          "$LAPTOP/Configs/config-weechat/"
        cmd "$HOME/.local/share/gnupg/"       "$LAPTOP/Configs/local-share-gnupg/"
        cmd "$HOME/.local/share/hamster/"     "$LAPTOP/Configs/local-share-hamster/"
        cmd "$HOME/.local/share/keyrings/"    "$LAPTOP/Configs/local-share-keyrings/"
    else
        printf ">>> %s is not mounted\n" "$LAPTOP"
        exit 1
    fi
else
    printf ">>> Unknown machine with hostname = %s\n" "$HNAME"
    exit 1
fi
