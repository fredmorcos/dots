#!/bin/bash

set -o pipefail
set -o errexit
set -o nounset
set -o noglob

CMD=("rsync"
     "-hhh"
     "--verbose"
     "--info=progress2"
     "--archive"
     "--executability"
     "--delete"
     "--delete-excluded"
     "--exclude=*/cargo-target"
     "--exclude=*/rustup"
     "--exclude=*/target"
     "--exclude=*/__pycache__"
     '--exclude=emacs/elpa/*'
     '--exclude=node_modules/*'
     '--exclude=clangd/*'
     "$@")

echo ">>> Rsync command:" "${CMD[@]}"

cmd () {
  printf ">>> %s --> %s\n" "$1" "$2"
  "${CMD[@]}" "$1" "$2"
  printf "\n\n"
}

HOSTNAME=$(hostnamectl hostname)
printf ">>> Hostname = %s\n\n\n" "$HOSTNAME"

if [ "$HOSTNAME" == "axon" ]; then
  HOME=/home/fred
  INTERNAL=/run/media/fred/Internal
  EXTERNAL=/run/media/fred/External

  if [ -d "$INTERNAL" ]; then
    cmd "$HOME/Archive/"                  "$INTERNAL/Fred/Archive/"
    cmd "$HOME/Documents/"                "$INTERNAL/Fred/Documents/"
    cmd "$HOME/Downloads/"                "$INTERNAL/Fred/Downloads/"
    cmd "$HOME/Music/"                    "$INTERNAL/Fred/Music/"
    cmd "$HOME/Music.New/"                "$INTERNAL/Fred/Music.New/"
    cmd "$HOME/Phone/"                    "$INTERNAL/Fred/Phone/"
    cmd "$HOME/Workspace/"                "$INTERNAL/Fred/Workspace/"

    cmd "$HOME/.ssh/"                     "$INTERNAL/Desktop/Configs/ssh/"
    cmd "$HOME/.config/beets/"            "$INTERNAL/Desktop/Configs/config-beets/"
    cmd "$HOME/.config/MusicBrainz/"      "$INTERNAL/Desktop/Configs/config-MusicBrainz/"
    cmd "$HOME/.config/transmission/"     "$INTERNAL/Desktop/Configs/config-transmission/"
    cmd "$HOME/.config/qBittorrent/"      "$INTERNAL/Desktop/Configs/config-qBittorrent/"
    cmd "$HOME/.config/protonvpn/"        "$INTERNAL/Desktop/Configs/config-protonvpn/"
    cmd "$HOME/.config/quodlibet/"        "$INTERNAL/Desktop/Configs/config-quodlibet/"
    cmd "$HOME/.config/yt-dlp/"           "$INTERNAL/Desktop/Configs/config-yt-dlp/"
    cmd "$HOME/.config/weechat/"          "$INTERNAL/Desktop/Configs/config-weechat/"
    cmd "$HOME/.local/share/gnupg/"       "$INTERNAL/Desktop/Configs/local-share-gnupg/"
    cmd "$HOME/.local/share/keyrings/"    "$INTERNAL/Desktop/Configs/local-share-keyrings/"

    if [ -d "$EXTERNAL" ]; then
      cmd "$INTERNAL/Desktop/"   "$EXTERNAL/Desktop/"
      cmd "$INTERNAL/Fred/"      "$EXTERNAL/Fred/"
      cmd "$INTERNAL/FredOther/" "$EXTERNAL/FredOther/"
    else
      printf ">>> %s is not mounted\n" "$EXTERNAL"
      exit 0
    fi
  else
    printf ">>> %s is not mounted\n" "$INTERNAL"
  fi
elif [ "$HOSTNAME" == "neuron" ]; then
  HOME=/home/fred
  LAPTOP=/run/media/fred/External/Laptop

  if [ -d "$LAPTOP" ]; then
    cmd "$HOME/Documents/"                "$LAPTOP/Documents/"
    cmd "$HOME/Downloads/"                "$LAPTOP/Downloads/"
    cmd "$HOME/Phone/"                    "$LAPTOP/Phone/"
    cmd "$HOME/Workspace/"                "$LAPTOP/Workspace/"
    cmd "$HOME/.ssh/"                     "$LAPTOP/Configs/ssh/"
    cmd "$HOME/.config/beets/"            "$LAPTOP/Configs/config-beets/"
    cmd "$HOME/.config/transmission/"     "$LAPTOP/Configs/config-transmission/"
    cmd "$HOME/.config/qBittorrent/"      "$LAPTOP/Configs/config-qBittorrent/"
    cmd "$HOME/.config/protonvpn/"        "$LAPTOP/Configs/config-protonvpn/"
    cmd "$HOME/.config/quodlibet/"        "$LAPTOP/Configs/config-quodlibet/"
    cmd "$HOME/.config/yt-dlp/"           "$LAPTOP/Configs/config-yt-dlp/"
    cmd "$HOME/.config/weechat/"          "$LAPTOP/Configs/config-weechat/"
    cmd "$HOME/.local/share/gnupg/"       "$LAPTOP/Configs/local-share-gnupg/"
    cmd "$HOME/.local/share/keyrings/"    "$LAPTOP/Configs/local-share-keyrings/"
  else
    printf ">>> %s is not mounted\n" "$LAPTOP"
  fi

  OX_EXTERNAL=/run/media/fred/OX-External/Laptop

  if [ -d "$OX_EXTERNAL" ]; then
    cmd "$HOME/Archive/"                  "$OX_EXTERNAL/Archive/"
    cmd "$HOME/Documents/"                "$OX_EXTERNAL/Documents/"
    cmd "$HOME/Downloads/"                "$OX_EXTERNAL/Downloads/"
    cmd "$HOME/Music/"                    "$OX_EXTERNAL/Music/"
    cmd "$HOME/Music.New/"                "$OX_EXTERNAL/Music.New/"
    cmd "$HOME/Phone/"                    "$OX_EXTERNAL/Phone/"
    cmd "$HOME/Workspace/"                "$OX_EXTERNAL/Workspace/"
    cmd "$HOME/.config/"                  "$OX_EXTERNAL/.config/"
    cmd "$HOME/.local/"                   "$OX_EXTERNAL/.local/"
    cmd "$HOME/.mozilla/"                 "$OX_EXTERNAL/.mozilla/"
    cmd "$HOME/.ssh/"                     "$OX_EXTERNAL/.ssh/"
    cmd "$HOME/.var/"                     "$OX_EXTERNAL/.var/"
  else
    printf ">>> %s is not mounted\n" "$OX_EXTERNAL"
  fi
else
  printf ">>> Unknown machine with hostname = %s\n" "$HOSTNAME"
fi
