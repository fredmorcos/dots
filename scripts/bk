#!/bin/bash

set -o pipefail
set -o errexit
set -o nounset
set -o noglob

CMD=("rsync"
     "-hhh"
     "--verbose"
     "--info=progress2"
     "--archive"
     "--executability"
     "--delete"
     "--delete-excluded"
     "--exclude=*/target"
     "--exclude=*/__pycache__"
     '--exclude=emacs/elpa/*'
     '--exclude=node_modules/*'
     "$@")

echo "Rsync command:" "${CMD[@]}"
printf "\n\n"

cmd () {
    printf ">>> %s --> %s\n" "$1" "$2"
    "${CMD[@]}" "$1" "$2"
    printf "\n\n"
}

HOME=/home/fred
INT=/run/media/fred/Internal
EXT=/run/media/fred/External

if [ -d $INT ]; then
    cmd "$HOME/Archive/"                  "$INT/Fred/Archive/"
    cmd "$HOME/Documents/"                "$INT/Fred/Documents/"
    cmd "$HOME/Downloads/"                "$INT/Fred/Downloads/"
    cmd "$HOME/Music/"                    "$INT/Fred/Music/"
    cmd "$HOME/Music.New/"                "$INT/Fred/Music.New/"
    cmd "$HOME/Phone/"                    "$INT/Fred/Phone/"
    cmd "$HOME/Workspace/"                "$INT/Fred/Workspace/"

    cmd "$HOME/.gnupg/"                   "$INT/Desktop/Configs/gnupg/"
    cmd "$HOME/.ssh/"                     "$INT/Desktop/Configs/ssh/"
    cmd "$HOME/.config/beets/"            "$INT/Desktop/Configs/config-beets/"
    cmd "$HOME/.config/MusicBrainz/"      "$INT/Desktop/Configs/config-MusicBrainz/"
    cmd "$HOME/.config/transmission/"     "$INT/Desktop/Configs/config-transmission/"
    cmd "$HOME/.config/yt-dlp/"           "$INT/Desktop/Configs/config-yt-dlp/"
    cmd "$HOME/.config/syncthing/"        "$INT/Desktop/Configs/config-syncthing/"
    cmd "$HOME/.local/share/keyrings/"    "$INT/Desktop/Configs/local-share-keyrings/"
    cmd "$HOME/.local/share/hamster/"     "$INT/Desktop/Configs/local-share-hamster/"

    if [ -d $EXT ]; then
        cmd "$INT/Desktop/"   "$EXT/Desktop/"
        cmd "$INT/Fred/"      "$EXT/Fred/"
        cmd "$INT/FredOther/" "$EXT/FredOther/"
    else
        printf ">>> %s is not mounted\n" $EXT
        exit 0
    fi
else
    printf ">>> %s is not mounted\n" $INT
    exit 1
fi
